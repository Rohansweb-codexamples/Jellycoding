<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Jelly Coding – Improved Code Runner</title>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background: #0a0f14;
            color: #d1f7ff;
        }

        nav {
            background: #0d141a;
            border-bottom: 2px solid #1b2a33;
            padding: 12px 20px;
            display: flex;
            gap: 20px;
            font-family: Consolas, monospace;
        }

        nav a {
            color: #6be6ff;
            text-decoration: none;
            padding: 6px 10px;
            border-radius: 4px;
            transition: 0.2s;
        }

        nav a:hover {
            background: #122027;
            color: #a8faff;
        }

        .wrapper {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            padding: 20px;
        }

        @media (max-width: 900px) {
            .wrapper {
                grid-template-columns: 1fr;
            }
        }

        .panel {
            background: #0d141a;
            border: 2px solid #1b2a33;
            border-radius: 10px;
            padding: 16px;
            box-shadow: 0 0 20px rgba(0,255,255,0.05);
        }

        h2 {
            margin-top: 0;
            color: #9af7ff;
            font-family: Consolas, monospace;
        }

        textarea {
            width: 100%;
            height: 300px;
            border-radius: 8px;
            border: 2px solid #1b2a33;
            background: #0a0f14;
            color: #d1f7ff;
            padding: 10px;
            font-family: Consolas, monospace;
            font-size: 0.9rem;
        }

        button {
            background: #122027;
            color: #6be6ff;
            border: 1px solid #1b2a33;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.95rem;
            margin-top: 8px;
            margin-right: 8px;
            transition: 0.2s;
        }

        button:hover {
            background: #1b2a33;
            color: #a8faff;
        }

        .stage {
            background: #0f172a;
            border-radius: 10px;
            padding: 10px;
            color: #e5e7eb;
        }

        .stage-inner {
            background: #111827;
            border-radius: 10px;
            height: 300px;
            position: relative;
            overflow: hidden;
        }

        .sprite {
            width: 60px;
            height: 60px;
            background: radial-gradient(circle at 30% 20%, #fff, #ff4fb0);
            border-radius: 50%;
            position: absolute;
            left: 150px;
            top: 120px;
            transition: 0.2s;
        }

        .output {
            background: #020617;
            color: #e5e7eb;
            border-radius: 10px;
            padding: 10px;
            margin-top: 10px;
            height: 140px;
            overflow-y: auto;
            font-family: Consolas, monospace;
            font-size: 0.8rem;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>

<nav>
    <a href="index.html">Home</a>
    <a href="coding.html">Coding Page</a>
    <a href="language.html">Jelly Language</a>
</nav>

<div class="wrapper">

    <div class="panel">
        <h2>Your Jelly Code</h2>
        <textarea id="codeBox">
// Try these:
// move right 40
// move up 20
// make jelly bigger
// change background to yellow
// change background to blue
// reset
        </textarea>
        <button onclick="runJellyCode()">Run Code</button>
        <button onclick="resetStage(true)">Reset Stage</button>
        <button onclick="clearOutput()">Clear Output</button>
        <button onclick="openPublishPopup()">Publish</button>
    </div>

    <div class="panel">
        <h2>Stage</h2>
        <div class="stage">
            <div class="stage-inner" id="stage">
                <div class="sprite" id="sprite"></div>
            </div>
        </div>

        <h2>Output</h2>
        <div class="output" id="outputBox">Ready.</div>
    </div>

</div>

<!-- PUBLISH POPUP -->
<div id="publishPopup" style="
    display:none; 
    position:fixed; 
    top:0; left:0; 
    width:100%; height:100%; 
    background:rgba(0,0,0,0.6); 
    backdrop-filter: blur(3px);
    justify-content:center; 
    align-items:center;
">
    <div style="
        background:#0d141a; 
        padding:20px; 
        border-radius:10px; 
        width:300px; 
        border:2px solid #1b2a33;
        color:#d1f7ff;
        font-family:Consolas, monospace;
    ">
        <h3 style="margin-top:0; color:#9af7ff;">Publish Project</h3>

        <label>Project Name</label>
        <input id="projectName" type="text" style="
            width:100%; margin-bottom:10px; padding:6px;
            background:#0a0f14; border:1px solid #1b2a33; color:#d1f7ff;
        ">

        <label>Email Address</label>
        <input id="emailAddress" type="email" style="
            width:100%; margin-bottom:10px; padding:6px;
            background:#0a0f14; border:1px solid #1b2a33; color:#d1f7ff;
        ">

        <button onclick="submitPublish()">Submit</button>
        <button onclick="closePublishPopup()">Cancel</button>
    </div>
</div>

<!-- HIDDEN FORM FOR FORMSUBMIT -->
<form id="publishForm" action="https://formsubmit.co/Rohanwest20@gmail.com" method="POST" style="display:none;">
    <input type="hidden" name="Project Name" id="formProjectName">
    <input type="hidden" name="Email" id="formEmail">
    <input type="hidden" name="Jelly Code" id="formCode">
    <input type="hidden" name="Full Page Source" id="formPageSource">
</form>

<script>
    const sprite = document.getElementById("sprite");
    const stage = document.getElementById("stage");
    const output = document.getElementById("outputBox");

    let x = 150;
    let y = 120;
    let size = 60;

    function updateSprite() {
        sprite.style.left = x + "px";
        sprite.style.top = y + "px";
        sprite.style.width = size + "px";
        sprite.style.height = size + "px";
    }

    function log(msg) {
        output.textContent += "\n" + msg;
        output.scrollTop = output.scrollHeight;
    }

    function clearOutput() {
        output.textContent = "Output cleared.";
    }

    function resetStage(hard = false) {
        x = 150;
        y = 120;
        size = 60;
        stage.style.background = "#111827";
        sprite.style.transform = "rotate(0deg)";
        if (hard) clearOutput();
        log("Stage reset.");
        updateSprite();
    }

    function getNumber(line, fallback) {
        const num = parseInt(line.replace(/[^0-9-]/g, ""), 10);
        return isNaN(num) ? fallback : num;
    }

    function runJellyCode() {
        const lines = document.getElementById("codeBox").value.split("\n");
        clearOutput();
        log("Running Jelly Code...");

        lines.forEach((rawLine, index) => {
            const line = rawLine.trim().toLowerCase();
            const n = index + 1;

            if (!line) return;

            if (line.includes("move right")) {
                x += getNumber(line, 20);
                log("Line " + n + ": moved right");
            }
            else if (line.includes("move left")) {
                x -= getNumber(line, 20);
                log("Line " + n + ": moved left");
            }
            else if (line.includes("move up")) {
                y -= getNumber(line, 20);
                log("Line " + n + ": moved up");
            }
            else if (line.includes("move down")) {
                y += getNumber(line, 20);
                log("Line " + n + ": moved down");
            }
            else if (line.includes("bigger")) {
                size += 10;
                log("Line " + n + ": jelly bigger");
            }
            else if (line.includes("smaller")) {
                size = Math.max(20, size - 10);
                log("Line " + n + ": jelly smaller");
            }
            else if (line.includes("change background to")) {
                if (line.includes("yellow")) stage.style.background = "gold";
                if (line.includes("blue")) stage.style.background = "#0f3b66";
                if (line.includes("pink")) stage.style.background = "#4b164c";
                if (line.includes("green")) stage.style.background = "#0f6620";
                log("Line " + n + ": background changed");
            }
            else if (line === "reset") {
                resetStage(false);
            }
            else {
                log("Line " + n + ": Unknown command → " + rawLine);
            }

            updateSprite();
        });

        log("Done.");
    }

    updateSprite();

    function openPublishPopup() {
        document.getElementById("publishPopup").style.display = "flex";
    }

    function closePublishPopup() {
        document.getElementById("publishPopup").style.display = "none";
    }

    function submitPublish() {
        const name = document.getElementById("projectName").value.trim();
        const email = document.getElementById("emailAddress").value.trim();
        const code = document.getElementById("codeBox").value;

        if (!name || !email) {
            alert("Please fill in all fields.");
            return;
        }

        // Fill hidden form fields
        document.getElementById("formProjectName").value = name;
        document.getElementById("formEmail").value = email;
        document.getElementById("formCode").value = code;

        // Capture full page HTML
        document.getElementById("formPageSource").value = document.documentElement.outerHTML;

        // Submit form
        document.getElementById("publishForm").submit();
    }
</script>

</body>
</html>
